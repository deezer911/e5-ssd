// Copyright (c) 2020,2021,2022, StepZen, Inc.

import * as os from 'os'
import * as isWsl from 'is-wsl'
import {SDKConfiguration, StepZenAccount, ZenCtlRequestHeaders} from './types'

const {version} = require('../../package.json')

// mimics the logic from @oclif/config
// https://github.com/oclif/core/blob/d7067d13c7d80c9e0064455c27ac1ebb6ee53fd2/src/config/config.ts#L128
const arch = os.arch() === 'ia32' ? 'x86' : (os.arch() as any)
const platform = isWsl ? 'wsl' : (os.platform() as any)

export const getRequestHeaders = (
  account: StepZenAccount,
  sdkConfig: SDKConfiguration,
): ZenCtlRequestHeaders => {
  const userAgent = `${sdkConfig.appName} stepzen-sdk/${version} (${platform}; ${arch}; node-${process.version})`

  return {
    authorization: `Apikey ${account.adminkey}`,
    host: `${account.account}.${account.domain}`,
    'stepzen-cli-version': version,
    'user-agent': userAgent,
  }
}
