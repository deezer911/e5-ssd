// Copyright (c) 2020,2021,2022, StepZen, Inc.

import * as debug from 'debug'
import fetch from 'node-fetch'

import {ADMIN_VERIFY_URL} from '../shared/constants'
import {getRequestHeaders} from '../shared/request'
import {SDKConfiguration, StepZenAccount} from '../shared/types'

export default async (
  settings: StepZenAccount,
  sdkConfig: SDKConfiguration,
): Promise<boolean> => {
  const headers = getRequestHeaders(settings, sdkConfig)
  const url = `${settings.server}${ADMIN_VERIFY_URL}`

  debug('stepzen:headers')(headers)
  debug('stepzen:url')(url)

  try {
    const response = await fetch(url, {
      headers: headers as any,
      method: 'POST',
    })
    await response.json()
    return true
  } catch {
    return false
  }
}
