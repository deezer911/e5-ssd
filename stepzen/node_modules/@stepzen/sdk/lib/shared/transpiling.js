"use strict";
// Copyright (c) 2020,2021,2022, StepZen, Inc.
Object.defineProperty(exports, "__esModule", { value: true });
exports.transpileConfigurationset = void 0;
const dotenv = require("dotenv");
const fs = require("fs-extra");
const os = require("os");
const path = require("path");
const { transpile } = require('@stepzen/transpiler');
const transpileConfigurationset = async (file) => {
    if (!file) {
        return;
    }
    const source = file.substring(0, file.lastIndexOf('/'));
    dotenv.config({ path: path.resolve(source, '.env') });
    const tmp = path.join(os.tmpdir(), `stepzen-transpiler-${Date.now()}`);
    const configPath = path.join(tmp, 'config.yaml');
    fs.ensureDirSync(tmp);
    fs.copyFileSync(file, configPath);
    const result = await transpile(tmp);
    if (result.transpiled) {
        fs.emptyDirSync(tmp);
        fs.writeFileSync(configPath, result.config);
        return configPath;
    }
    fs.removeSync(tmp);
    return;
};
exports.transpileConfigurationset = transpileConfigurationset;
//# sourceMappingURL=transpiling.js.map