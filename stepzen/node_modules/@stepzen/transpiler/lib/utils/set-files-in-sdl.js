"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const glob = require("glob");
const graphql_1 = require("graphql");
const path = require("path");
const graphql_helpers_1 = require("./graphql-helpers");
const print_1 = require("../actions/print");
exports.default = (source) => {
    const files = glob
        .sync('**/*.graphql', { cwd: source })
        .filter(file => file !== 'index.graphql');
    const output = path.join(source, 'index.graphql');
    const index = fs.readFileSync(output, 'utf8');
    let ast = graphql_1.parse(index);
    ast = graphql_1.visit(ast, {
        Directive(node) {
            if (node.name.value === 'sdl') {
                const mutated = graphql_helpers_1.cloneDeep(node);
                mutated.arguments = mutated.arguments.map((arg) => {
                    if (arg.name.value === 'files') {
                        arg.value.values = files.map(file => ({
                            kind: 'StringValue',
                            value: file,
                        }));
                    }
                    return arg;
                });
                return mutated;
            }
        },
    });
    fs.writeFileSync(output, print_1.default(ast));
};
//# sourceMappingURL=set-files-in-sdl.js.map