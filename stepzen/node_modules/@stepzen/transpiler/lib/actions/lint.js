"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const node_fetch_1 = require("node-fetch");
const fs = require("fs-extra");
const os = require("os");
const path = require("path");
const shell = require("shelljs");
const stitch_1 = require("../actions/stitch");
exports.default = async (source, options = {
    extensions: '',
}) => {
    if (!fs.existsSync(source)) {
        throw new Error(`Cannot find source directory ${source}`);
    }
    let extensions = options.extensions;
    if (!extensions) {
        const response = await node_fetch_1.default('https://www.steprz.net/directives.graphql');
        extensions = await response.text();
    }
    const stitched = stitch_1.default(source);
    const index = path.join(stitched, 'index.graphql');
    const graphql = fs.readFileSync(index, 'utf8');
    const tmp = path.join(os.tmpdir(), `stepzen-lint-${Date.now()}`);
    fs.ensureDirSync(tmp);
    const lintFile = path.join(tmp, 'index.graphql');
    fs.writeFileSync(lintFile, `${extensions}${os.EOL}${os.EOL}${graphql}`);
    shell.exec(`npx graphql-schema-linter ${lintFile}`, { silent: true }, (code, stdout, stderr) => {
        console.log(stdout);
        fs.removeSync(tmp);
    });
};
//# sourceMappingURL=lint.js.map